# Архитектурная документация CLI

## 1. Общая информация

### 1.1. Назначение документа

Документ описывает архитектуру CLI-интерпретатора, разработанного для выполнения встроенных команд (cat, echo, wc, pwd,
exit) и вызова внешних программ. Документ включает описание компонентов системы, их взаимодействие, принятые
архитектурные решения, альтернативы, преимущества и риски.

### 1.2. Описание системы

**Название системы:** Интерпретатор командной строки (CLI)

**Описание:** CLI представляет собой систему обработки команд, поддерживающую выполнение встроенных
команд (`cat`, `echo`, `wc`, `pwd`, `exit`) и вызов внешних программ. Команды могут содержать переменные окружения, а
также объединяться с помощью пайплайнов (`|`). Система не включает графический интерфейс и работает исключительно в
командной строке.

---

## 2. Стейкхолдеры и их интересы

### 2.1. Стейкхолдеры

| Стейкхолдер       | Интерес                                                                                 |
|-------------------|-----------------------------------------------------------------------------------------|
| Пользователи      | Удобство работы с CLI, простота использования, возможность выполнения команд и скриптов |
| Разработчики      | Простота поддержки, четкая архитектура, расширяемость и модульность архитектуры         |
| Владельцы проекта | Стабильность работы, соответствие требованиям                                           |
| Сопровождающие    | Легкость поддержки, документированность кода, тестируемость                             |

### 2.2. Влияние архитектуры на стейкхолдеров:

- Модульная структура системы упрощает сопровождение и расширение функциональности.
- Использование стандартных механизмов работы с процессами (`ProcessBuilder`) обеспечивает предсказуемость и надежность
  выполнения внешних команд.
- Поддержка переменных окружения и пайплайнов делает CLI более удобным для пользователей.

---

## 3. Viewpoints

### 3.1 Структурный вид

На [структурной диаграмме](se-hw-diagram.jpg) показаны основные классы системы и их взаимодействие:

- **Main** – точка входа, отвечает за обработку пользовательского ввода и передачу его в `Parser`.
- **Parser** – разбирает ввод пользователя, обрабатывает кавычки, переменные окружения и пайплайны.
- **Command** – представляет команду, содержит её имя и аргументы.
- **Executor** – выполняет команды (встроенные или внешние).
- **Environment** – управляет переменными окружения.
- **Pipeline** – обрабатывает пайплайны, связывая команды через потоки ввода-вывода.

### 3.2 Process View

На [диаграмме последовательности](se-hw-diagram.jpg) показан поток выполнения:

1. Пользователь вводит команду.
2. Если команда exit или EOF, программа завершает работу.
3. Parser разбирает строку на токены, обрабатывает кавычки и подставляет переменные окружения.
4. Создается объект Command.
5. Если команда одна, она передается в Executor. Если команды соединены оператором |, они передаются в Pipeline.
6. Executor или Pipeline выполняет команды.
7. Встроенные команды выполняются напрямую, внешние – через `ProcessBuilder`.
8. Результат выполнения команды выводится на экран. Если команда не найдена или произошла ошибка, выводится сообщение об
   ошибке с кодом возврата.

### 3.3 Контекстный вид
Взаимодействие системы CLI с внешними сущностями:
- Пользователь: Взаимодействует с CLI через командную строку, вводя команды и получая результаты.
- Операционная система: CLI использует системные вызовы для выполнения внешних программ и управления процессами.
- Внешние программы: CLI вызывает внешние программы через механизмы операционной системы (ProcessBuilder).
- Файловая система: CLI взаимодействует с файловой системой для выполнения команд, таких как cat, wc, и pwd.

CLI является центральным компонентом, который связывает пользователя, операционную систему и внешние программы.

---

## 4. Обоснование архитектуры

### 4.1. Принятые решения

- Подстановка переменных выполняется до разбиения строки на токены.
    - Преимущества: Упрощает логику парсинга, делает поведение системы предсказуемым.
    - Риски: Нет.

- Использование ProcessBuilder для внешних команд.
    - Преимущества: Поддержка любых внешних программ.
    - Риски: Зависимость от внешних программ и их доступности.

- Пайплайны обрабатываются отдельным классом Pipeline.
    - Преимущества: Четкое разделение ответственности, легкость расширения.
    - Риски: Нет.

- Модульная архитектура.
    - Преимущества: улучшенная поддержка и тестируемость, простая модификация и расширение функционала, разделение
      ответственности между компонентами.
    - Недостатки: Требует большего проектирования на ранних этапах.

### 4.2. Альтернативы

- Подстановка переменных после токенизации.
    - Преимущества: Проще реализовать.
    - Недостатки: Усложняет логику обработки кавычек и аргументов.
- Использование Runtime.exec() вместо ProcessBuilder.
    - Преимущества: Более простой API.
    - Недостатки: Меньше контроля над процессами.
- Объединение всех функций в одном классе:
    - Преимущества: Простота начальной реализации.
    - Недостатки: Сложность поддержки и расширения, низкая модульность.

---

## 5. Риски и пути их минимизации

| Риск                            | Возможные последствия                                         | Меры минимизации                                         |
|---------------------------------|---------------------------------------------------------------|----------------------------------------------------------|
| Ошибки в разборе команд         | Некорректное выполнение команд                                | Покрытие тестами парсера, логирование                    |
| Зависимость от внешних программ | Если внешняя программа недоступна, команда не будет выполнена | Обработка ошибок процессов, вывод сообщений пользователю |

---

## 6. Требования

### 6.1. Функциональные требования

- Поддержка встроенных команд (cat, echo, wc, pwd, exit).
- Поддержка вызова внешних программ.
- Поддержка переменных окружения.
- Поддержка пайплайнов.
- Поддержка использования кавычек

### 6.2. Нефункциональные требования

- Кроссплатформенность (Windows, Linux, macOS).
- Простота расширения (добавление новых команд).
- Надежность (обработка ошибок и логирование).

## 7. Эволюция системы

Система разработана с учетом возможного расширения:

- Добавление новых встроенных команд. Например, добавление команды `grep` для поиска по тексту.
- Расширение механизма работы с переменными окружения.
- Поддержка дополнительных операторов (например, `&&`, `||`).

## 8. Дополнения

### 8.1. Диаграммы
- [Диаграмма классов](se-hw-diagram.jpg)
- [Диаграмма последовательности](se-hw-diagram.jpg)

### 8.2. Глоссарий
- **Пайплайн**: Последовательность команд, соединенных оператором `|`.
- **CLI**: Интерфейс командной строки, позволяющий пользователю взаимодействовать с системой через текстовые команды.
- **Токенизация**: Процесс разбиения входной строки на отдельные элементы (токены), такие как команды, аргументы и операторы.
- **ProcessBuilder**: Класс в Java, используемый для создания и управления внешними процессами.
- **Executor**: Компонент системы, отвечающий за выполнение команд (встроенных или внешних).
- **Parser**: Компонент системы, отвечающий за разбор пользовательского ввода и подготовку команд к выполнению.
- **Environment**: Компонент системы, управляющий переменными окружения и их подстановкой в команды.
- **Pipeline**: Компонент системы, отвечающий за обработку пайплайнов и связывание команд через потоки ввода-вывода.

